import { ImageResponse } from "@vercel/og";

export const config = {
  runtime: "edge",
};

// Load ABC Diatype font (OTF format)
const fontUrl = new URL(
  "../../public/fonts/ABCDiatypeEdu-Regular.otf",
  import.meta.url
);
const fontPromise = fetch(fontUrl).then((res) => res.arrayBuffer());

export default async function handler(req) {
  const fontData = await fontPromise;
  const { searchParams } = new URL(req.url);
  const title = searchParams.get("title") || "Charlsy Yang";

  return new ImageResponse(
    (
      <div
        style={{
          height: "100%",
          width: "100%",
          display: "flex",
          backgroundColor: "#6550b9",
          padding: "80px",
        }}
      >
        <div
          style={{
            display: "flex",
            flexDirection: "column",
            alignItems: "flex-start",
            justifyContent: "space-between",
            maxWidth: "900px",
          }}
        >
          <h1
            style={{
              fontSize: title.length > 50 ? "64px" : "72px",
              fontWeight: 400,
              color: "#ffffff",
              lineHeight: 1.15,
              margin: 0,
              letterSpacing: "-0.02em",
              fontFamily: "ABC Diatype",
            }}
          >
            {title}
          </h1>
          <div
            style={{
              display: "flex",
              alignItems: "center",
              marginTop: "40px",
              gap: "12px",
              opacity: 0.8,
            }}
          >
            <svg
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              style={{ marginTop: "10px" }}
            >
              <path
                d="M6.65791 10.9717C6.99939 10.3327 7.49629 9.86288 8.10732 9.59528C8.41237 9.4598 9.00765 9.32984 9.31797 9.32974C9.7734 9.3324 10.0784 9.41663 10.5106 9.65982C11.1374 10.0181 11.4388 10.413 11.6503 11.1715L11.7695 11.5992L11.9891 11.61C12.1098 11.616 12.2186 11.618 12.232 11.6143C12.2454 11.6106 12.2865 11.4731 12.3234 11.3079C12.5243 10.4236 12.9296 9.61198 13.3774 9.19903C13.7478 8.85805 14.0143 8.70091 14.511 8.54082C15.4106 8.24678 16.1717 8.29745 16.9252 8.69598C17.7933 9.15618 18.3055 9.84162 18.5367 10.8647C18.9565 12.7068 18.1238 14.5091 16.1245 16.0749C15.1117 16.8687 14.4707 17.6632 14.3716 18.2526C14.3427 18.4335 14.3498 18.5108 14.4206 18.7647C14.4933 19.0254 14.5253 19.0885 14.6593 19.2456C14.8535 19.4759 15.1812 19.6546 15.5207 19.7076C15.7477 19.7452 15.8184 19.7399 16.1536 19.6608C16.4721 19.5864 16.5664 19.5493 16.7438 19.435C17.1327 19.1861 17.4102 18.8351 17.5491 18.4146C17.656 18.0859 17.6706 17.8406 17.6058 17.4013C17.5403 16.9334 17.5702 16.7558 17.7467 16.5733C17.8977 16.416 18.2323 16.2831 18.4968 16.2741C18.8937 16.2607 19.3016 16.5071 19.4634 16.8545C19.8651 17.7256 19.0309 18.9918 17.5103 19.8155C17.1552 20.0045 15.701 20.4316 15.1682 20.501C13.0613 20.7751 10.844 20.1869 9.21335 18.9202C8.0072 17.9853 7.05296 16.6596 6.56863 15.2461C5.99823 13.5757 6.0296 12.1481 6.65791 10.9717Z"
                fill="#ffffff"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M15.8035 1.43551C15.8784 1.36779 16.0032 1.27178 16.0813 1.22839C16.2698 1.11464 16.6146 1.01847 16.8381 1.01739C17.3886 1.01155 17.8769 1.30035 18.1737 1.8082C18.3053 2.03439 18.4516 2.559 18.4634 2.8474C18.4997 3.74119 18.0602 4.75325 17.2161 5.71243C16.5867 6.43172 15.8807 6.90227 14.9854 7.19872C14.4763 7.36588 13.9163 7.42838 13.2248 7.39432C12.9537 7.37987 12.7284 7.37427 12.726 7.37854C12.7212 7.38709 12.5702 8.15302 12.39 9.08558C12.2098 10.0181 12.0549 10.796 12.0453 10.8131C12.0323 10.8311 11.9719 10.7183 11.9038 10.5644L11.7816 10.2816L11.8955 9.42154C11.9613 8.94582 12.0471 8.27006 12.0849 7.91381C12.1431 7.3718 12.1429 7.26743 12.0952 7.2519C12.0788 7.24708 11.9857 7.22528 11.851 7.19372C11.7278 7.16487 11.5698 7.12787 11.4037 7.08822C11.0557 7.00517 10.1369 6.76438 9.35974 6.55253C5.83734 5.59359 4.82917 5.57579 3.82623 6.45685C3.59711 6.65758 3.52292 6.75389 3.3465 7.06597C3.22084 7.28827 3.11992 7.52168 3.09077 7.66305C2.92405 8.43699 3.22184 9.14263 3.92307 9.63855C4.04515 9.72695 4.15142 9.82336 4.16074 9.85678C4.19335 9.97373 4.08063 10.4625 3.97969 10.6311C3.66998 11.164 2.91281 11.2311 2.48396 10.7673C1.81203 10.0399 1.97352 8.36711 2.86638 6.76769C3.36477 5.87607 3.93344 5.31417 4.6849 4.9678C5.02399 4.81203 5.74892 4.64231 6.09794 4.63863C6.69811 4.62974 7.45984 4.79908 8.36937 5.13609C8.63173 5.23579 8.84795 5.31235 8.84701 5.30901C8.84608 5.30567 8.71745 5.12906 8.55996 4.91369C8.33341 4.60593 8.27774 4.50981 8.28962 4.44888C8.3004 4.40986 8.39092 4.22977 8.49242 4.05021C8.78819 3.532 9.14489 3.24528 9.68974 3.08976C10.3494 2.90584 10.9492 3.01228 11.4921 3.4191C12.0426 3.82741 12.4656 4.51614 12.5911 5.2122C12.6362 5.4517 12.7173 6.15655 12.7246 6.33817C12.7241 6.41394 12.7717 6.42947 13.2495 6.51233C14.0882 6.66019 14.5232 6.65415 15.1025 6.49264C15.5478 6.36847 15.8305 6.21762 16.1279 5.95104C16.3998 5.70957 16.6541 5.31455 16.7085 5.0437C16.7623 4.7838 16.7412 4.46199 16.659 4.25801C16.5534 3.99576 16.3733 3.81551 15.9601 3.56338C15.7553 3.43684 15.5533 3.29507 15.5116 3.24908C15.3581 3.08662 15.2836 2.5996 15.3544 2.24497C15.3998 2.01982 15.6454 1.58042 15.8035 1.43551ZM11.7819 4.71756C11.5254 4.32813 11.0295 3.97304 10.6413 3.9012C10.4778 3.87117 10.3632 3.87432 10.1805 3.91805C9.8453 3.99711 9.71436 4.08403 9.57903 4.32344C9.48478 4.49017 9.46807 4.55965 9.48024 4.73272C9.49561 4.99492 9.61702 5.24917 9.83646 5.47968C10.081 5.7356 10.2299 5.81653 10.7615 5.98882C11.1978 6.13005 12.0357 6.33939 12.0993 6.32165C12.1361 6.31138 12.1359 5.85768 12.0973 5.57676C12.0587 5.29583 11.9288 4.94669 11.7819 4.71756Z"
                fill="#ffffff"
              />
            </svg>
            <p
              style={{
                fontSize: "32px",
                color: "#ffffff",
                fontWeight: 400,
                fontFamily: "ABC Diatype",
                margin: 0,
              }}
            >
              charlsyang.com
            </p>
          </div>
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "ABC Diatype",
          data: fontData,
          style: "normal",
          weight: 400,
        },
      ],
    }
  );
}
